# Development overrides (auto-merged with docker-compose.yml)
services:
  db:
    ports:
      - "${POSTGRES_PORT:-5432}:5432"
    
    environment:
      POSTGRES_INITDB_ARGS: "-E UTF8 --locale=en_US.UTF-8"
    
    volumes:
      - ./scripts/init-db:/docker-entrypoint-initdb.d:ro

  app:
    build:
      target: runtime
    
    environment:
      SPRING_PROFILES_ACTIVE: dev
      JPA_SHOW_SQL: "true"
      JPA_DDL_AUTO: update
      SPRING_DEVTOOLS_RESTART_ENABLED: "true"
      SPRING_DEVTOOLS_LIVERELOAD_ENABLED: "true"
      JAVA_TOOL_OPTIONS: "-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005"
    
    ports:
      - "5005:5005"
    
    volumes:
      - ./build:/app/build:ro
      - ./logs:/app/logs

  adminer:
    image: adminer:4-standalone
    platform: linux/amd64
    container_name: ${COMPOSE_PROJECT_NAME:-planificador}-adminer
    restart: unless-stopped
    
    labels:
      - "com.utec.project=planificador-docente"
      - "com.utec.component=database-admin"
      - "com.utec.environment=development"
    
    ports:
      - "${ADMINER_PORT:-8081}:8080"
    
    networks:
      - app-network
    
    depends_on:
      - db
    
    environment:
      ADMINER_DEFAULT_SERVER: db
      ADMINER_DESIGN: pepa-linha
  
  ldap:
    labels:
      - "com.utec.environment=development"
    
    ports:
      - "127.0.0.1:389:389"
      - "127.0.0.1:636:636"

  phpldapadmin:
    profiles: ["ldap"]
    image: osixia/phpldapadmin:0.9.0
    platform: linux/amd64
    container_name: ${COMPOSE_PROJECT_NAME:-planificador}-phpldapadmin
    restart: unless-stopped
    
    labels:
      - "com.utec.project=planificador-docente"
      - "com.utec.component=ldap-admin"
      - "com.utec.environment=development"
    
    environment:
      PHPLDAPADMIN_LDAP_HOSTS: ldap
      PHPLDAPADMIN_HTTPS: "false"
      PHPLDAPADMIN_LDAP_CLIENT_TLS: "false"
    
    ports:
      - "6443:80"
    
    networks:
      - app-network
    
    depends_on:
      - ldap


