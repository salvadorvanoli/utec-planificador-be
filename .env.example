# ============================================
# UTEC Planificador - Environment Configuration
# ============================================
# This file serves as a template for environment variables.
# 
# SETUP INSTRUCTIONS:
# 1. Copy this file to .env in the project root:
#    cp .env.example .env
# 
# 2. Fill in your actual values (especially JWT_SECRET in production)
# 
# 3. NEVER commit .env to git (already in .gitignore)
#
# USAGE:
# - Docker development: docker-compose up -d
# - Docker with LDAP: docker-compose --profile ldap up -d
# - Local development (no Docker): See RUNNING.md
# 
# PRODUCTION DEPLOYMENT:
# docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
# ============================================

# ============================================
# Docker Compose Configuration
# ============================================
COMPOSE_PROJECT_NAME=utec-planificador

# ============================================
# Docker Compose Profiles (Optional Services)
# ============================================
# LDAP Authentication Services
# 
# To enable LDAP with OpenLDAP server and phpLDAPadmin UI:
# 1. Uncomment the line below:
#    COMPOSE_PROFILES=ldap
# 
# 2. Set LDAP_ENABLED=true in the LDAP Configuration section
# 
# 3. Run: docker-compose up -d
# 
# This will start:
# - OpenLDAP server on ports 389 (LDAP) and 636 (LDAPS)
# - phpLDAPadmin UI on http://localhost:6443
#   Default credentials: cn=admin,dc=utec,dc=edu,dc=uy / admin123
# 
# COMPOSE_PROFILES=ldap

# ============================================
# Database Configuration
# ============================================
POSTGRES_DB=planificador_db
POSTGRES_USER=planificador_user
POSTGRES_PASSWORD=change_this_password_in_production
POSTGRES_PORT=5432

# PostgreSQL Production Settings
POSTGRES_MAX_CONNECTIONS=200
POSTGRES_SHARED_BUFFERS=512MB

# ============================================
# Database Connection (Local Development Only)
# ============================================
# These variables are ONLY needed when running the application 
# locally WITHOUT Docker (e.g., ./gradlew bootRun or from IDE)
# 
# When using Docker, these are automatically mapped from POSTGRES_* variables
# in docker-compose.yml, so you DON'T need to set them in .env
# 
# For local development, uncomment and configure:
# DATABASE_URL=jdbc:postgresql://localhost:5432/planificador_db
# DATABASE_USERNAME=planificador_user
# DATABASE_PASSWORD=change_this_password_in_production

# ============================================
# Adminer (Database Management UI)
# ============================================
# Adminer port for web interface
# Access at: http://localhost:8081
# Default server: db
ADMINER_PORT=8081

# ============================================
# Application Configuration
# ============================================
# Options: dev, prod, test
SPRING_PROFILES_ACTIVE=dev

# Application port mapping (it must match the one defined in the Frontend)
APP_PORT=8080
SERVER_PORT=8080

# ============================================
# JPA & Hibernate Configuration
# ============================================
# Options: none, validate, update, create, create-drop
JPA_DDL_AUTO=update
# Set to true for debugging SQL queries
JPA_SHOW_SQL=false
HIBERNATE_BATCH_SIZE=20

# ============================================
# HikariCP Connection Pool Configuration
# ============================================
HIKARI_MAX_POOL_SIZE=10
HIKARI_MIN_IDLE=5
HIKARI_CONNECTION_TIMEOUT=30000
HIKARI_IDLE_TIMEOUT=600000
HIKARI_MAX_LIFETIME=1800000

# ============================================
# CORS Configuration
# ============================================
CORS_ALLOWED_ORIGINS=http://localhost:4200,http://127.0.0.1:4200

# ============================================
# Health Check Configuration
# ============================================

# Database health check
DB_HEALTHCHECK_INTERVAL=10s
DB_HEALTHCHECK_TIMEOUT=5s
DB_HEALTHCHECK_RETRIES=5
DB_HEALTHCHECK_START_PERIOD=10s

# Application health check
HEALTHCHECK_INTERVAL=30s
HEALTHCHECK_TIMEOUT=10s
HEALTHCHECK_RETRIES=3
HEALTHCHECK_START_PERIOD=40s

# ============================================
# JVM Configuration
# ============================================
# Leave empty to use defaults from Dockerfile
# Customize for specific needs (e.g., memory, GC):
# Example: -XX:+UseContainerSupport -XX:MaxRAMPercentage=75.0 -Xms512m -Xmx1024m
JAVA_OPTS=

# ============================================
# Docker Resource Limits (Production)
# ============================================

# Database resource limits
DB_CPU_LIMIT=2
DB_MEMORY_LIMIT=2G
DB_CPU_RESERVATION=1
DB_MEMORY_RESERVATION=1G

# Application resource limits
APP_CPU_LIMIT=2
APP_MEMORY_LIMIT=2G
APP_CPU_RESERVATION=1
APP_MEMORY_RESERVATION=1G

# ============================================
# Docker Restart Policy (Production)
# ============================================
RESTART_POLICY_CONDITION=on-failure
RESTART_POLICY_DELAY=5s
RESTART_POLICY_MAX_ATTEMPTS=3
RESTART_POLICY_WINDOW=120s

# ============================================
# Docker Registry (for CI/CD)
# ============================================
# Uncomment and configure for container registry deployment
# DOCKER_REGISTRY=registry.example.com
# IMAGE_TAG=latest
# APP_VERSION=latest

# ============================================
# JWT Configuration
# ============================================
# CRITICAL SECURITY WARNING FOR PRODUCTION
# 
# The JWT_SECRET below is ONLY for development/testing!
# This is a DEFAULT value and should NEVER be used in production.
# 
# FOR PRODUCTION DEPLOYMENT:
# 1. Generate a NEW secure secret using:
#    openssl rand -base64 64
# 
# 2. Set it in your production environment variables
# 
# 3. NEVER commit production secrets to git!
# 
# 4. Use environment-specific configuration management:
#    - Docker secrets
#    - Kubernetes secrets
#    - AWS Secrets Manager
#    - Azure Key Vault
#    - HashiCorp Vault
# ============================================

# Secret key for signing JWT tokens
JWT_SECRET=VXRlY1BsYW5pZmljYWRvckRvY2VudGVTZWNyZXRLZXlGb3JKV1RBdXRoZW50aWNhdGlvbjIwMjVVcnVndWF5VGVjaG5vbG9naWNhbFVuaXZlcnNpdHk=

# JWT token expiration time in milliseconds (24 hours = 86400000)
JWT_EXPIRATION=86400000

# JWT token issuer
JWT_ISSUER=UTEC-Planificador

# ============================================
# Authentication Configuration
# ============================================
# Default authentication provider: LOCAL or LDAP
AUTH_DEFAULT_PROVIDER=LOCAL

# ============================================
# LDAP Configuration (Optional)
# ============================================
# Enable/disable LDAP authentication
# Set to 'true' to enable LDAP authentication
# Remember to also activate the ldap profile in COMPOSE_PROFILES above
LDAP_ENABLED=false

# LDAP Server Configuration
# For development with Docker (if COMPOSE_PROFILES=ldap): ldap://ldap:389
# For local OpenLDAP: ldap://localhost:389
# For production: ldaps://ldap.utec.edu.uy:636 (use LDAPS for security!)
LDAP_URL=ldap://ldap:389

# Base DN for LDAP searches
LDAP_BASE=dc=utec,dc=edu,dc=uy

# User DN pattern (the {0} is replaced by the username)
# Example: uid=john,ou=people,dc=utec,dc=edu,dc=uy
LDAP_USER_DN_PATTERN=uid={0},ou=people

# User search filter for LDAP queries
# (uid={0}) means search for user where uid equals the provided username
LDAP_USER_SEARCH_FILTER=(uid={0})

# Default role assigned to new LDAP users
# Options: ADMINISTRATOR, EDUCATION_MANAGER, COORDINATOR, TEACHER, ANALYST
# Default: TEACHER
LDAP_DEFAULT_ROLE=TEACHER

# Default campus ID for new LDAP users
# This campus will be assigned to users created via LDAP authentication
# Must be a valid campus ID from your database
# Default: 1 (adjust according to your campus configuration)
LDAP_DEFAULT_CAMPUS_ID=1

# ============================================
# LDAP Manager Credentials (Optional)
# ============================================
# Required if your LDAP server requires authentication for searches
# Leave empty if anonymous searches are allowed
# 
# For development with Docker LDAP (from docker-compose.override.yml):
# LDAP_MANAGER_DN=cn=admin,dc=utec,dc=edu,dc=uy
# LDAP_MANAGER_PASSWORD=admin123
# 
# For production, use secure credentials from your LDAP administrator
LDAP_MANAGER_DN=
LDAP_MANAGER_PASSWORD=

# ============================================
# Logging Configuration
# ============================================
LOG_LEVEL=INFO
LOG_SECURITY_LEVEL=DEBUG
LOG_SPRING_SECURITY=INFO
LOG_LDAP=DEBUG

# Log file path (relative to application root)
# Default: logs/application.log
LOG_FILE=logs/application.log

# Docker logging driver configuration
LOG_DRIVER=json-file
LOG_MAX_SIZE=10m
LOG_MAX_FILE=3
